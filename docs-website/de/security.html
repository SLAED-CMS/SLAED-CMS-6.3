<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sicherheitsleitfaden - SLAED CMS Dokumentation</title>
    <meta name="description" content="Umfassender Sicherheitsleitfaden für SLAED CMS. Erfahren Sie mehr über integrierte Sicherheitsfunktionen, bewährte Verfahren zum Sichern Ihrer Installation, Umgang mit Benutzereingaben und Schutz vor gängigen Web-Schwachstellen.">
    <link rel="canonical" href="https://slaed.de/security.html">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <!-- Preload dark theme to prevent flash of white -->
    <script src="theme-preload.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="/">
                        <img src="logo.png" alt="SLAED CMS Logo" class="logo-img">
                        <span class="logo-text">SLAED CMS</span>
                    </a>
                </div>
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Dokumentation durchsuchen...">
                    <button class="search-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                    </button>
                </div>
                <div class="header-actions">
                    <button class="theme-toggle" aria-label="Design umschalten" title="Design umschalten">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </button>
                    <a href="https://slaed.info" class="slaed-link" aria-label="English Version" title="English Version">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="2" y1="12" x2="22" y2="12"></line>
                            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                        </svg>
                    </a>
                    <a href="https://slaed.net" class="slaed-link" aria-label="Offizielle SLAED CMS Seite" title="Offizielle SLAED CMS Seite">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>
                    </a>
                    <a href="https://github.com/SLAED-CMS" class="github-link" aria-label="SLAED CMS auf GitHub" title="SLAED CMS auf GitHub">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="main-layout">
            <!-- Sidebar Navigation -->
            <aside class="sidebar">
                <nav class="sidebar-nav">
                    <div class="nav-section">
                        <h3 class="nav-title">Erste Schritte</h3>
                        <ul class="nav-list">
                            <li class="nav-item">
                                <a href="index.html" class="nav-link">Einführung</a>
                            </li>
                            <li class="nav-item">
                                <a href="installation.html" class="nav-link">Installation</a>
                            </li>
                            <li class="nav-item">
                                <a href="configuration.html" class="nav-link">Konfiguration</a>
                            </li>
                            <li class="nav-item">
                                <a href="upgrade.html" class="nav-link">Upgrade-Anleitung</a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="nav-section">
                        <h3 class="nav-title">Grundkonzepte</h3>
                        <ul class="nav-list">
                            <li class="nav-item">
                                <a href="architecture.html" class="nav-link">Architektur</a>
                            </li>
                            <li class="nav-item">
                                <a href="modules.html" class="nav-link">Module</a>
                            </li>
                            <li class="nav-item">
                                <a href="templates.html" class="nav-link">Vorlagen</a>
                            </li>
                            <li class="nav-item">
                                <a href="database.html" class="nav-link">Datenbank</a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="nav-section">
                        <h3 class="nav-title">API Referenz</h3>
                        <ul class="nav-list">
                            <li class="nav-item">
                                <a href="core-functions.html" class="nav-link">Kernfunktionen</a>
                            </li>
                            <li class="nav-item">
                                <a href="database-api.html" class="nav-link">Datenbank</a>
                            </li>
                            <li class="nav-item">
                                <a href="template-api.html" class="nav-link">Vorlage</a>
                            </li>
                            <li class="nav-item">
                                <a href="security-api.html" class="nav-link">Sicherheit</a>
                            </li>
                            <li class="nav-item">
                                <a href="admin-api.html" class="nav-link">Admin</a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="nav-section">
                        <h3 class="nav-title">Leitfäden</h3>
                        <ul class="nav-list">
                            <li class="nav-item">
                                <a href="creating-modules.html" class="nav-link">Module erstellen</a>
                            </li>
                            <li class="nav-item">
                                <a href="custom-themes.html" class="nav-link">Benutzerdefinierte Designs</a>
                            </li>
                            <li class="nav-item">
                                <a href="performance.html" class="nav-link">Leistung</a>
                            </li>
                            <li class="nav-item">
                                <a href="security.html" class="nav-link active">Sicherheit</a>
                            </li>
                            <li class="nav-item">
                                <a href="admin-guide.html" class="nav-link">Admin-Leitfaden</a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="nav-section">
                        <h3 class="nav-title">Über</h3>
                        <ul class="nav-list">
                            <li class="nav-item">
                                <a href="eduard-laas.html" class="nav-link">Schöpfer</a>
                            </li>
                            <li class="nav-item">
                                <a href="history.html" class="nav-link">Geschichte</a>
                            </li>
                            <li class="nav-item">
                                <a href="privacy-policy.html" class="nav-link">Datenschutzbestimmungen</a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <div class="content-wrapper">
                    <div class="content-header">
                        <nav class="breadcrumbs" aria-label="Breadcrumbs">
                            <ol>
                                <li><a href="index.html">Startseite</a></li>
                                <li><a href="index.html">Dokumentation</a></li>
                                <li><a href="#">Leitfäden</a></li>
                                <li aria-current="page">Sicherheit</li>
                            </ol>
                        </nav>
                    </div>
                    
                    <article class="doc-content">
                        <h1>Sicherheitsleitfaden</h1>
                        <p class="lead">SLAED CMS wird mit Fokus auf Sicherheit entwickelt und beinhaltet ein mehrschichtiges Schutzsystem gegen wichtige Arten von Angriffen und Bedrohungen.</p>
                        
                        <div class="toc">
                            <h2>Inhaltsverzeichnis</h2>
                            <ul>
                                <li><a href="#architecture">Sicherheitsarchitektur</a></li>
                                <li><a href="#attacks">Schutz vor Hauptangriffen</a></li>
                                <li><a href="#authentication">Authentifizierung & Autorisierung</a></li>
                                <li><a href="#automation">Schutz vor automatisierten Angriffen</a></li>
                                <li><a href="#monitoring">Sicherheitsüberwachung & Protokollierung</a></li>
                                <li><a href="#configuration">Konfigurationssicherheit</a></li>
                                <li><a href="#recommendations">Sicherheitsempfehlungen</a></li>
                            </ul>
                        </div>
                        
                        <h2 id="architecture">Sicherheitsarchitektur</h2>
                        
                        <h3>Sicherheitsprinzipien</h3>
                        <ol>
                            <li><strong>Defense in Depth</strong> - Mehrschichtiger Schutz</li>
                            <li><strong>Prinzip der geringsten Rechte</strong> - Minimal notwendige Rechte</li>
                            <li><strong>Eingabevalidierung</strong> - Validierung aller Eingabedaten</li>
                            <li><strong>Ausgabekodierung</strong> - Kodierung aller Ausgabedaten</li>
                            <li><strong>Standardmäßig sicher</strong> - Sichere Einstellungen standardmäßig</li>
                        </ol>
                        
                        <h3>Hauptkomponenten des Schutzes</h3>
                        <pre><code class="language-text">┌─────────────────────────────────────────┐
│           SECURITY LAYERS               │
├─────────────────────────────────────────┤
│ 1. Webserver-Sicherheit (Apache/Nginx)  │
│ 2. Anwendungs-Firewall                  │
│ 3. Eingabevalidierung & Bereinigung     │
│ 4. Authentifizierung & Autorisierung    │
│ 5. Sitzungsmanagement                   │
│ 6. CSRF-Schutz                          │
│ 7. XSS-Prävention                       │
│ 8. SQL-Injection-Prävention             │
│ 9. Datei-Upload-Sicherheit              │
│ 10. Protokollierung & Überwachung       │
└─────────────────────────────────────────┘</code></pre>
                        
                        <h2 id="attacks">Schutz vor Hauptangriffen</h2>
                        
                        <h3>1. SQL-Injection-Schutz</h3>
                        
                        <h4>Verwendung von Prepared Statements</h4>
                        <pre><code class="language-php">// SICHER - Prepared Statements
$stmt = $db->prepare("SELECT * FROM {$prefix}_users WHERE user_id = ? AND active = ?");
$stmt->bind_param("ii", $user_id, $active);
$stmt->execute();
$result = $stmt->get_result();

// UNSICHER - Direkte Ersetzung (NICHT VERWENDEN!)
$query = "SELECT * FROM {$prefix}_users WHERE user_id = " . $user_id;</code></pre>
                        
                        <h4>Automatische Filterung in Kernfunktionen</h4>
                        <pre><code class="language-php">// getVar-Funktion filtert automatisch Eingabedaten
$id = getVar('get', 'id', 'num');        // Nur Zahlen
$email = getVar('post', 'email', 'email'); // E-Mail-Validierung
$text = getVar('post', 'text', 'text');   // Sicherer Text</code></pre>
                        
                        <h3>2. XSS (Cross-Site Scripting) Schutz</h3>
                        
                        <h4>Eingabefilterung</h4>
                        <pre><code class="language-php">// Automatische Filterung in getVar
function getVar($method, $name, $type, $default = '') {
    switch($type) {
        case 'text':
            return htmlspecialchars($value, ENT_QUOTES, 'UTF-8');
        case 'html':
            return filter_html($value);
        case 'var':
            return preg_replace('#[^a-zA-Z0-9_-]#', '', $value);
    }
}

// Zusätzlicher Schutz beim Ausgeben
function xss_clean($str) {
    $str = htmlspecialchars($str, ENT_QUOTES, 'UTF-8');
    $str = preg_replace('#javascript:#i', '', $str);
    $str = preg_replace('#vbscript:#i', '', $str);
    $str = preg_replace('#onload#i', '', $str);
    return $str;
}</code></pre>
                        
                        <h4>Content Security Policy (CSP)</h4>
                        <pre><code class="language-php">// In Vorlagendateien
header("Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline' https://www.google.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:;");</code></pre>
                        
                        <h3>3. CSRF (Cross-Site Request Forgery) Schutz</h3>
                        
                        <h4>Token-Erstellung und Verifizierung</h4>
                        <pre><code class="language-php">// CSRF-Token erzeugen
function generate_csrf_token() {
    if (!isset($_SESSION['csrf_token'])) {
        $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
    }
    return $_SESSION['csrf_token'];
}

// CSRF-Token verifizieren
function verify_csrf_token($token) {
    if (!isset($_SESSION['csrf_token'])) {
        return false;
    }
    return hash_equals($_SESSION['csrf_token'], $token);
}

// Verwendung in Formularen
echo '&lt;input type="hidden" name="csrf_token" value="'.generate_csrf_token().'"&gt;';

// Verifizierung bei der Formularverarbeitung
if (!verify_csrf_token(getVar('post', 'csrf_token', 'text'))) {
    die('CSRF-Token stimmt nicht überein');
}</code></pre>
                        
                        <h3>4. Datei-Upload-Sicherheit</h3>
                        
                        <h4>Strenge Datei-Upload-Prüfung</h4>
                        <pre><code class="language-php">function secure_file_upload($file, $allowed_types, $max_size, $upload_dir) {
    // 1. Dateityp nach Erweiterung prüfen
    $ext = strtolower(pathinfo($file['name'], PATHINFO_EXTENSION));
    if (!in_array($ext, $allowed_types)) {
        return false;
    }
    
    // 2. MIME-Typ prüfen
    $finfo = finfo_open(FILEINFO_MIME_TYPE);
    $mime = finfo_file($finfo, $file['tmp_name']);
    finfo_close($finfo);
    
    $allowed_mimes = array(
        'jpg' => 'image/jpeg',
        'png' => 'image/png',
        'gif' => 'image/gif',
        'pdf' => 'application/pdf'
    );
    
    if (!isset($allowed_mimes[$ext]) || $allowed_mimes[$ext] !== $mime) {
        return false;
    }
    
    // 3. Größe prüfen
    if ($file['size'] > $max_size) {
        return false;
    }
    
    // 4. Auf ausführbare Dateien prüfen
    $dangerous_extensions = array('php', 'phtml', 'php3', 'php4', 'php5', 'pl', 'py', 'jsp', 'asp', 'sh', 'cgi');
    if (in_array($ext, $dangerous_extensions)) {
        return false;
    }
    
    // 5. Sicheren Dateinamen generieren
    $safe_name = uniqid().'_'.preg_replace('#[^a-zA-Z0-9.-]#', '_', basename($file['name']));
    
    // 6. Datei verschieben
    if (move_uploaded_file($file['tmp_name'], $upload_dir.'/'.$safe_name)) {
        return $safe_name;
    }
    
    return false;
}</code></pre>
                        
                        <h4>Zusätzliche Sicherheitsmaßnahmen</h4>
                        <pre><code class="language-apache"># .htaccess im Uploads-Ordner
&lt;Files "*.php"&gt;
    Deny from all
&lt;/Files&gt;
&lt;Files "*.phtml"&gt;
    Deny from all
&lt;/Files&gt;
&lt;Files "*.php3"&gt;
    Deny from all
&lt;/Files&gt;</code></pre>
                        
                        <h2 id="authentication">Authentifizierung & Autorisierung</h2>
                        
                        <h3>Rollen- und Zugriffssystem</h3>
                        <pre><code class="language-php">// Benutzerhierarchie
define('USER_GUEST', 0);        // Gast
define('USER_MEMBER', 1);       // Benutzer
define('USER_MODERATOR', 2);    // Moderator
define('USER_ADMIN', 3);        // Administrator
define('USER_SUPERADMIN', 4);   // Super-Administrator

// Zugriffsebene prüfen
function check_access_level($required_level, $user_level = null) {
    global $user;
    
    if ($user_level === null) {
        $user_level = isset($user[3]) ? intval($user[3]) : USER_GUEST;
    }
    
    return $user_level >= $required_level;
}

// Modul-Admin prüfen
function is_module_admin($module) {
    global $db, $prefix, $user;
    
    if (!is_user()) return false;
    if (is_admin()) return true;
    
    $user_id = intval($user[0]);
    $stmt = $db->prepare("SELECT COUNT(*) FROM {$prefix}_module_admins WHERE user_id = ? AND module = ?");
    $stmt->bind_param("is", $user_id, $module);
    $stmt->execute();
    $result = $stmt->get_result();
    $count = $result->fetch_row()[0];
    
    return $count > 0;
}</code></pre>
                        
                        <h3>Sichere Authentifizierung</h3>
                        <pre><code class="language-php">// Passwort-Hashing
function hash_password($password) {
    return password_hash($password, PASSWORD_ARGON2ID, [
        'memory_cost' => 65536,  // 64MB
        'time_cost' => 4,        // 4 Iterationen
        'threads' => 3,          // 3 Threads
    ]);
}

// Passwort-Verifizierung
function verify_password($password, $hash) {
    return password_verify($password, $hash);
}

// Passwort-Stärke prüfen
function check_password_strength($password) {
    $strength = 0;
    
    if (strlen($password) >= 8) $strength++;
    if (preg_match('/[a-z]/', $password)) $strength++;
    if (preg_match('/[A-Z]/', $password)) $strength++;
    if (preg_match('/[0-9]/', $password)) $strength++;
    if (preg_match('/[^a-zA-Z0-9]/', $password)) $strength++;
    
    return $strength; // 0-5
}</code></pre>
                        
                        <h3>Sitzungsmanagement</h3>
                        <pre><code class="language-php">// Sichere Sitzungseinstellungen
function init_secure_session() {
    // Sitzungs-Cookie-Einstellungen
    $cookie_params = array(
        'lifetime' => 0,
        'path' => '/',
        'domain' => '',
        'secure' => isset($_SERVER['HTTPS']),
        'httponly' => true,
        'samesite' => 'Strict'
    );
    
    session_set_cookie_params($cookie_params);
    
    // Sitzungs-ID neu generieren
    if (!isset($_SESSION['initiated'])) {
        session_regenerate_id(true);
        $_SESSION['initiated'] = true;
    }
    
    // IP-Adresse und User-Agent prüfen
    if (isset($_SESSION['user_ip']) && $_SESSION['user_ip'] !== getIp()) {
        session_destroy();
        return false;
    }
    
    if (isset($_SESSION['user_agent']) && $_SESSION['user_agent'] !== getUserAgent()) {
        session_destroy();
        return false;
    }
    
    $_SESSION['user_ip'] = getIp();
    $_SESSION['user_agent'] = getUserAgent();
    
    return true;
}

// Sichere Sitzungsbeendigung
function secure_logout() {
    $_SESSION = array();
    
    if (ini_get("session.use_cookies")) {
        $params = session_get_cookie_params();
        setcookie(session_name(), '', time() - 42000,
            $params["path"], $params["domain"],
            $params["secure"], $params["httponly"]
        );
    }
    
    session_destroy();
}</code></pre>
                        
                        <h2 id="automation">Schutz vor automatisierten Angriffen</h2>
                        
                        <h3>Rate Limiting / Flood-Schutz</h3>
                        <pre><code class="language-php">// Flood-Schutz
function check_flood_protection($action, $ip = null, $user_id = null) {
    global $db, $prefix, $confs;
    
    if (!$confs['flood_enable']) return true;
    
    $ip = $ip ?: getIp();
    $user_id = $user_id ?: (is_user() ? intval($user[0]) : 0);
    $time_limit = time() - intval($confs['flood_time']);
    
    // Versuche zählen
    $stmt = $db->prepare("SELECT COUNT(*) FROM {$prefix}_flood_log WHERE action = ? AND (ip = ? OR user_id = ?) AND timestamp > ?");
    $stmt->bind_param("ssii", $action, $ip, $user_id, $time_limit);
    $stmt->execute();
    $attempts = $stmt->get_result()->fetch_row()[0];
    
    if ($attempts >= intval($confs['flood_attempts'])) {
        // Versuch protokollieren
        log_security_event('FLOOD_DETECTED', array(
            'action' => $action,
            'ip' => $ip,
            'user_id' => $user_id,
            'attempts' => $attempts
        ));
        
        return false;
    }
    
    // Versuch aufzeichnen
    $stmt = $db->prepare("INSERT INTO {$prefix}_flood_log (action, ip, user_id, timestamp) VALUES (?, ?, ?, ?)");
    $current_time = time();
    $stmt->bind_param("ssii", $action, $ip, $user_id, $current_time);
    $stmt->execute();
    
    return true;
}</code></pre>
                        
                        <h3>CAPTCHA-Integration</h3>
                        <pre><code class="language-php">// Google reCAPTCHA v3
function verify_recaptcha_v3($response, $action = 'homepage') {
    global $confs;
    
    if (!$confs['captcha_enable']) return true;
    
    $secret_key = $confs['recaptcha_secret_key'];
    $verify_url = 'https://www.google.com/recaptcha/api/siteverify';
    
    $data = array(
        'secret' => $secret_key,
        'response' => $response,
        'remoteip' => getIp()
    );
    
    $options = array(
        'http' => array(
            'header' => "Content-type: application/x-www-form-urlencoded\r\n",
            'method' => 'POST',
            'content' => http_build_query($data)
        )
    );
    
    $context = stream_context_create($options);
    $result = file_get_contents($verify_url, false, $context);
    $response_data = json_decode($result, true);
    
    if ($response_data['success'] && 
        $response_data['action'] === $action && 
        $response_data['score'] >= floatval($confs['recaptcha_score'])) {
        return true;
    }
    
    log_security_event('CAPTCHA_FAILED', array(
        'ip' => getIp(),
        'score' => $response_data['score'] ?? 0,
        'action' => $action
    ));
    
    return false;
}</code></pre>
                        
                        <h2 id="monitoring">Sicherheitsüberwachung & Protokollierung</h2>
                        
                        <h3>Protokollierungssystem</h3>
                        <pre><code class="language-php">// Sicherheitsereignisse protokollieren
function log_security_event($event_type, $data = array()) {
    global $user;
    
    $log_entry = array(
        'timestamp' => date('Y-m-d H:i:s'),
        'event_type' => $event_type,
        'ip' => getIp(),
        'user_agent' => getUserAgent(),
        'user_id' => is_user() ? intval($user[0]) : 0,
        'data' => $data
    );
    
    $log_line = json_encode($log_entry) . "\n";
    file_put_contents(LOGS_DIR.'/security.log', $log_line, FILE_APPEND | LOCK_EX);
    
    // Kritische Ereignisse
    if (in_array($event_type, array('ADMIN_LOGIN_FAILED', 'SQL_INJECTION_ATTEMPT', 'XSS_ATTEMPT'))) {
        send_security_alert($event_type, $log_entry);
    }
}

// Alarme für kritische Ereignisse senden
function send_security_alert($event_type, $log_entry) {
    global $conf;
    
    $subject = 'Sicherheitsalarm: ' . $event_type;
    $message = "Sicherheitsereignis erkannt:\n\n";
    $message .= "Typ: " . $event_type . "\n";
    $message .= "Zeit: " . $log_entry['timestamp'] . "\n";
    $message .= "IP: " . $log_entry['ip'] . "\n";
    $message .= "User Agent: " . $log_entry['user_agent'] . "\n";
    $message .= "Details: " . json_encode($log_entry['data'], JSON_PRETTY_PRINT);
    
    mail($conf['admin_email'], $subject, $message);
}</code></pre>
                        
                        <h3>Überwachung verdächtiger Aktivitäten</h3>
                        <pre><code class="language-php">// Verdächtige Muster analysieren
function analyze_suspicious_activity($ip) {
    global $db, $prefix;
    
    $suspicious_score = 0;
    $last_hour = time() - 3600;
    
    // Häufige fehlgeschlagene Login-Versuche
    $stmt = $db->prepare("SELECT COUNT(*) FROM {$prefix}_login_attempts WHERE ip = ? AND success = 0 AND timestamp > ?");
    $stmt->bind_param("si", $ip, $last_hour);
    $stmt->execute();
    $failed_logins = $stmt->get_result()->fetch_row()[0];
    
    if ($failed_logins > 10) $suspicious_score += 3;
    elseif ($failed_logins > 5) $suspicious_score += 2;
    elseif ($failed_logins > 3) $suspicious_score += 1;
    
    // Häufige Anfragen an nicht existente Seiten
    $stmt = $db->prepare("SELECT COUNT(*) FROM {$prefix}_404_log WHERE ip = ? AND timestamp > ?");
    $stmt->bind_param("si", $ip, $last_hour);
    $stmt->execute();
    $not_found_requests = $stmt->get_result()->fetch_row()[0];
    
    if ($not_found_requests > 20) $suspicious_score += 2;
    elseif ($not_found_requests > 10) $suspicious_score += 1;
    
    // SQL-Injection-Versuche
    $stmt = $db->prepare("SELECT COUNT(*) FROM {$prefix}_security_log WHERE ip = ? AND event_type = 'SQL_INJECTION_ATTEMPT' AND timestamp > ?");
    $stmt->bind_param("si", $ip, $last_hour);
    $stmt->execute();
    $sql_attempts = $stmt->get_result()->fetch_row()[0];
    
    if ($sql_attempts > 0) $suspicious_score += 5;
    
    // Automatische Blockierung bei hohem Verdachtswert
    if ($suspicious_score >= 5) {
        block_ip($ip, 'Verdächtige Aktivität erkannt');
        log_security_event('IP_AUTO_BLOCKED', array('ip' => $ip, 'score' => $suspicious_score));
    }
    
    return $suspicious_score;
}</code></pre>
                        
                        <h2 id="configuration">Konfigurationssicherheit</h2>
                        
                        <h3>Konfigurationsdateien schützen</h3>
                        <pre><code class="language-apache"># .htaccess zum Schutz des config-Ordners
&lt;Files "*.php"&gt;
    Order Deny,Allow
    Deny from all
    Allow from 127.0.0.1
&lt;/Files&gt;

&lt;Files "*.txt"&gt;
    Order Deny,Allow
    Deny from all
&lt;/Files&gt;

&lt;Files "*.log"&gt;
    Order Deny,Allow
    Deny from all
&lt;/Files&gt;</code></pre>
                        
                        <h3>Sichere Dateiberechtigungen</h3>
                        <pre><code class="language-bash"># Richtige Dateiberechtigungen setzen
find /path/to/slaed/ -type f -exec chmod 644 {} \;
find /path/to/slaed/ -type d -exec chmod 755 {} \;

# Spezielle Berechtigungen für kritische Ordner
chmod 700 /path/to/slaed/config/
chmod 777 /path/to/slaed/uploads/
chmod 777 /path/to/slaed/storage/

# Ausführung im Uploads-Ordner deaktivieren
chmod -x /path/to/slaed/uploads/*</code></pre>
                        
                        <h2 id="recommendations">Sicherheitsempfehlungen</h2>
                        
                        <h3>Regelmäßige Sicherheitsprüfungen</h3>
                        <ol>
                            <li><strong>Protokollprüfung</strong> - Tägliche Analyse der Sicherheitsprotokolle</li>
                            <li><strong>Updates</strong> - Zeitnahe PHP-, MySQL-, Webserver-Updates</li>
                            <li><strong>Überwachung</strong> - Kontrolle verdächtiger Aktivitäten</li>
                            <li><strong>Backups</strong> - Regelmäßige Sicherung</li>
                            <li><strong>Tests</strong> - Periodische Penetrationstests</li>
                        </ol>
                        
                        <h3>Sicherheits-Checkliste</h3>
                        <ul>
                            <li class="checklist-item">PHP auf neueste Version aktualisiert</li>
                            <li class="checklist-item">Neueste Sicherheitsupdates installiert</li>
                            <li class="checklist-item">Webserver-Firewall konfiguriert</li>
                            <li class="checklist-item">HTTPS/SSL aktiviert</li>
                            <li class="checklist-item">Sichere HTTP-Header konfiguriert</li>
                            <li class="checklist-item">Unbenutzte PHP-Module und Funktionen deaktiviert</li>
                            <li class="checklist-item">Sicherheitsprotokollierung konfiguriert</li>
                            <li class="checklist-item">Überwachungslösungen eingerichtet</li>
                            <li class="checklist-item">Verwundbarkeitstests durchgeführt</li>
                            <li class="checklist-item">Automatische Backups konfiguriert</li>
                        </ul>
                        
                        <p>Durch das Befolgen dieser Empfehlungen und die Nutzung der integrierten Schutzmechanismen von SLAED CMS gewährleisten Sie ein hohes Sicherheitsniveau für Ihre Website.</p>
                        
                        <div class="doc-footer">
                            <div class="next-prev">
                                <a href="performance.html" class="prev-link">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="19" y1="12" x2="5" y2="12"></line>
                                        <polyline points="12 19 5 12 12 5"></polyline>
                                    </svg>
                                    Zurück
                                </a>
                                <a href="upgrade.html" class="next-link">
                                    Weiter
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="5" y1="12" x2="19" y2="12"></line>
                                        <polyline points="12 5 19 12 12 19"></polyline>
                                    </svg>
                                </a>
                            </div>
                            
                            <div class="read-next">
                                <h3>Weiterlesen</h3>
                                <div class="read-next-links">
                                    <a href="admin-guide.html">Admin-Leitfaden</a>
                                    <a href="eduard-laas.html">Schöpfer</a>
                                    <a href="history.html">Geschichte</a>
                                </div>
                            </div>
                        </div>
                    </article>
                </div>
            </main>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-left">
                    <ul class="footer-links">
                        <li><a href="privacy-policy.html" title="Datenschutzbestimmungen">Datenschutz</a></li>
                        <li><a href="history.html" title="Geschichte von SLAED CMS">Geschichte</a></li>
                        <li><a href="https://slaed.net" title="Offizielle Website von SLAED CMS">Offiziell</a></li>
                        <li><a href="eduard-laas.html" title="Schöpfer und Chefentwickler von SLAED CMS">Über</a></li>
                        <li><a href="https://github.com/SLAED-CMS" target="_blank" title="SLAED CMS auf GitHub">GitHub</a></li>
                    </ul>
                </div>
                <div class="footer-info">
                    <p>&copy; 2005-<span id="current-year">2026</span> Eduard Laas. Alle Rechte vorbehalten.</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
</body>
</html>