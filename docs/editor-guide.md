# Руководство по редактору SLAED CMS

## Содержание
1. [Введение](#введение)
2. [Разделы редактора](#разделы-редактора)
3. [Ядро системы](#ядро-системы)
4. [Шапка системы](#шапка-системы)
5. [Системный ЧПУ](#системный-чпу)
6. [Серверный ЧПУ](#серверный-чпу)
7. [Правила для роботов](#правила-для-роботов)
8. [Примеры использования](#примеры-использования)

## Введение

**Внимание!**
Данный раздел предназначен только для администраторов, которые хорошо знакомы с серверным ПО и языком PHP.

Раздел «Редактор» позволяет непосредственно через панель администрирования управлять основными системными файлами. Управление файлами производится во вкладках:

Для внесения изменений в файл перейдите в соответствующую вкладку и внесите изменения в открывшийся редактор содержимого файла, для сохранения нажмите «Сохранить».

**Внимание!**
Если на конфигурационные файлы не будут установленные соответствующие права доступа (CHMOD - 666), то система выдаст соответствующее предупреждение.

## Разделы редактора

### Ядро системы
Файл внедрения в ядро системы: config_core.php. Во вкладке можно добавить код, который будет размещён в ядре системы.

### Шапка системы
Файл внедрения в шапку системы: config_header.php. Во вкладке можно вставить код, который будет внедрён в head системы. Как правило, данный файл используют для внедрения java-скриптов и мета тегов.

### Системный ЧПУ
Файл конфигураций правил преобразований ЧПУ на системном уровне: config_rewrite.php. Во вкладке можно изменить или дополнить стандартные правила преобразований адресных строк браузера. Данная возможность поддерживается только в случае установленного на сервере Mod Rewrite.

### Серверный ЧПУ
Файл конфигураций правил преобразований ЧПУ на серверном уровне: .htaccess. Во вкладке можно изменить или дополнить стандартные правила преобразований адресных строк браузера на серверном уровне. Данная возможность поддерживается только в случае установленного на сервере Mod Rewrite.

### Правила для роботов
Файл конфигураций инструкций и параметров индексирования для поисковых роботов: robots.txt. Во вкладке можно изменить или дополнить текстовый файл, находящийся в корневой директории сайта, в котором записываются специальные инструкции для поисковых роботов. Эти инструкции могут запрещать к индексации некоторые разделы или страницы на сайте, указывать на правильное «зеркалирование» домена, рекомендовать поисковому роботу соблюдать определенный временной интервал между скачиванием документов с сервера и т.д. В этом файле Вы можете указать параметры индексирования сайта как для всех роботов сразу, так и для каждой поисковой системы по отдельности.

## Примеры использования редактора внедрений в отделе «Шапка системы»

### Перенаправление посетителя, пришедшего с определённого сайта

Перейдите во вкладку «Шапка системы» и добавьте следующую запись:

```php
$reflink = "#slaed.net#i";
$metlink = "news.html";
$referer = text_filter(getenv("HTTP_REFERER"));
if (preg_match($reflink, $referer)) { 
echo '<meta http-equiv="refresh" content="0; url='.$metlink.'">'; 
}
```

$reflink – отвечает за адрес сайта, с которого пришёл посетитель.
Вместо: slaed.net укажите свой домен.
$metlink – отвечает за страницу, куда будет перенаправлен посетитель
Вместо: news.html укажите необходимую страницу или сайт.

### Запрещаем копировать информацию с сайта

Всё что можно прочитать и увидеть, соответственно можно скопировать. Эффективной защиты от копирования не существует. Но это не значит, что ей нельзя препятствовать, можно отключить использование правой или других кнопок мыши, которые применяются для копирования, это станет незначительным, но всё-таки препятствием в копировании для начинающих пользователей.

Перейдите во вкладку «Шапка системы» и добавьте следующую запись:

```php
echo '<script>
<!--
function click() {
// Чтобы отключить левую кнопку поставьте цифру 1 
// Чтобы отключить третью кнопку поставьте цифру 3 
if (event.button == 2) { 
// Здесь введите свою надпись, которая появится в окне предупреждения 
alert("Copyright Scriptic!"); 
}
}
document.onmousedown=click;
//-->
</script>';
```

Заметим, что работает этот код только на браузерах Internet Explorer. Не исключено что и для других браузеров есть нечто подобное. Если захотите воспользоваться другим кодом, просто замените этот на свой код, вставив его между echo ' и ';

### Перенаправление посетителя из определённой страны

Перейдите во вкладку «Шапка системы» и добавьте следующую запись:

```php
$userlang = "Russia"; 
$metlink = "news.html"; 
$userip = user_geo_ip(getip(), 2); 
if ($userip == $userlang) { 
echo '<meta http-equiv="refresh" content="0; url='.$metlink.'">'; 
}
```

$userlang – отвечает за название страны, с которой пришел посетитель.
Название страны не должно быть произвольным и должно соответствовать стандартам использования класса. Правильность написания той или иной страны можно проверить в переменной $COUNTRY_NAMES файла: core/geo_ip.php
$metlink – отвечает за страницу, куда будет перенаправлен посетитель
Вместо: news.html укажите необходимую страницу или сайт.

## Примеры использования редактора внедрений в отделе «Серверный ЧПУ»

### Установка запрета на использование другими сайтами любых изображений с сайта

Ни для кого не секрет, что некоторые сайты для экономии своего трафика и размера используемого места на сервере применяют удалённые изображения с других сайтов, тем самым поглощают чужой трафик и повышают нагрузку на сервер. Чтобы этому воспрепятствовать, предлагаем к использованию следующие методы.

Перейдите во вкладку «Серверный ЧПУ» и добавьте после:

```apache
# Mod rewrite on
RewriteEngine On
RewriteBase /
```

следующую запись:

```apache
RewriteOptions MaxRedirects=100
RewriteCond %{HTTP_REFERER} !^http://(www\.)?slaed\.net/ [NC]
RewriteRule \.(jpe?g|gif|bmp|png)$ http://www.slaed.net/templates/default/images/logos/slaed_logo_60x60.png [L]
```

Вместо: slaed укажите имя домена своего сайта.
Вместо: net укажите зону домена своего сайта.
Вместо: http://www.slaed.net/templates/default/images/logos/slaed_logo_60x60.png укажите ссылку на логотип или изображение, которое будет отображаться на том сайте, который использует изображения с сайта.

### Объединение домена с www и без

На первый взгляд домен с приставкой www и без неё является одинаковым, на самом деле это не так. Сервером они инициируются как два разных домена и, как правило, на них можно установить два совершенно разных сайта. У некоторых хостеров слияние двух доменов предусмотрено изначально и производится автоматически, у некоторых данная настройка существует в панели управления хостингом, для хостингов у которых слияние не предусмотрено можно воспользоваться следующим методом.

Перейдите во вкладку «Серверный ЧПУ» и добавьте после:

```apache
# Mod rewrite on
RewriteEngine On
RewriteBase /
```

следующую запись:

```apache
# Redirect
RewriteCond %{HTTP_HOST} !^www\.slaed\.net [NC]
RewriteRule ^(.*)$ http://www.slaed.net/$1 [R=301,L]
```

Вместо: slaed укажите имя домена своего сайта.
Вместо: net укажите зону домена своего сайта.
Для работы данного метода, сервер хостера должен поддерживать работу с .htaccess, Mod Rewrite должен быть установлен и активирован.

### Возможные правила и настройки

В описании ниже, вашему вниманию предлагаются возможные правила с описанием, которые допустимы к использованию в нашем случае на «Серверном ЧПУ», а именно в основном файле .htaccess, который находится в главной директории системы.

```apache
# Запрет листинга и просмотра директорий
Options All -ExecCGI -Indexes -Includes +FollowSymLinks
```

```apache
# Индексная страница сайта
DirectoryIndex index.php
```

```apache
# Кодировка сайта по умолчанию
AddDefaultCharset utf-8
```

```apache
# Редирект, в случае соответствующей ошибки на сервере
ErrorDocument 400    /index.php?error=400
ErrorDocument 401    /index.php?error=401
ErrorDocument 403    /index.php?error=403
ErrorDocument 404    /index.php?error=404
ErrorDocument 500    /index.php?error=500
ErrorDocument 503    /index.php?error=503
```

```apache
# Настройки безопасности, актуальны для версий ниже PHP 5.3.0, для PHP 5.4.0 и выше неактуальны
php_flag register_globals off
php_flag safe_mode on
php_flag magic_quotes_gpc on
```

```apache
# Запрет показа версий серверного ПО
ServerSignature Off
```

Приведённое выше правило, поддерживается увы не всеми хостерами. Описанные ниже настройки доступны только в случае установленного на сервере mod_rewrite.

```apache
# Включение mod_rewrite
RewriteEngine On
```

Модуль mod_rewrite является программным модулем веб сервера Apache (обратите внимание, что он не будет выполняться под другими веб серверами!). Его первичная функция - манипуляция действий с URL. Модуль очень универсален и разносторонен, здесь показаны некоторые реальные примеры.

```apache
# Корневая директория
RewriteBase /
```

```apache
# Редирект с www на без www
RewriteCond %{HTTP_HOST}    ^www\.(.*) [NC]
RewriteRule ^(.*)$    http://%1/$1 [R=301,L]
```

```apache
# Редирект с без www на www
RewriteCond %{HTTP_HOST}    ^[^.]+\.[^.]+$
RewriteCond %{HTTPS}s    ^on(s)|
RewriteRule ^    http%1://www.%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
```

```apache
# Редирект с протокола http на https
RewriteCond %{HTTPS} off
RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
```

```apache
# Редирект адресов с index.php на без index.php
RewriteCond %{THE_REQUEST}    ^GET.*index\.php [NC]
RewriteRule (.*?)index\.php/*(.*)    /$1$2 [R=301,L]
```

```apache
# Редирект на новую категорию
RewriteRule ^старая/(.*)$    /новая/$1 [R=301,L]
```

```apache
# Правила обработки запросов для блокировки распространенных эксплоитов
RewriteCond %{QUERY_STRING}    proc/self/environ [OR]
RewriteCond %{QUERY_STRING}    mosConfig_[a-zA-Z_]{1,21}(=|\%3D) [OR]
RewriteCond %{QUERY_STRING}    base64_(en|de)code\(.*\) [OR]
RewriteCond %{QUERY_STRING}    base64_encode[^(]*\([^)]*\) [OR]
RewriteCond %{QUERY_STRING}    (<|\%3C)([^s]*s)+cript.*(>|\%3E) [NC,OR]
RewriteCond %{QUERY_STRING}    GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
RewriteCond %{QUERY_STRING}    _REQUEST(=|\[|\%[0-9A-Z]{0,2})
RewriteRule .*    index.php [F]
```

```apache
# Блокирование MySQL инъекций
RewriteCond %{QUERY_STRING}    CONCAT.*\( [NC,OR]
RewriteCond %{QUERY_STRING}    UNION.*SELECT.*\( [NC,OR]
RewriteCond %{QUERY_STRING}    UNION.*ALL.*SELECT [NC]
RewriteRule ^(.*)$    index.php [F,L]
```

```apache
# Блокировка файловых инъекций 
RewriteCond %{REQUEST_METHOD}    GET
RewriteCond %{QUERY_STRING}    [a-zA-Z0-9_]=http:// [OR]
RewriteCond %{QUERY_STRING}    [a-zA-Z0-9_]=(\.\./?)+ [OR]
RewriteCond %{QUERY_STRING}    [a-zA-Z0-9_]=/([a-z0-9_.]/?)+ [NC]
RewriteRule .*    - [F]
```

```apache
# Редирект для чужих доменов
RewriteCond %{HTTP_HOST}    !^slaed\.net$
RewriteRule ^(.*)$    http://slaed.net/$1 [R=301,L]
```

---

© 2005-2026 Eduard Laas. All rights reserved.