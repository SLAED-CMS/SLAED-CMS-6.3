# Архитектура SLAED CMS

## Обзор архитектуры

SLAED CMS построена на модульной архитектуре с четким разделением ответственности между компонентами. Система спроектирована для обеспечения высокой производительности, стабильности и безопасности.

---

*© 2005-2026 Eduard Laas. All rights reserved.*

## Диаграмма архитектуры

```
┌─────────────────────────────────────────────────────────────┐
│                    SLAED CMS Architecture                   │
├─────────────────────────────────────────────────────────────┤
│  Frontend Layer                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ Templates   │  │   Themes    │  │   Blocks    │         │
│  │   System    │  │   Engine    │  │   System    │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
├─────────────────────────────────────────────────────────────┤
│  Application Layer                                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │   Modules   │  │   Routing   │  │   Security  │         │
│  │   System    │  │   Engine    │  │   Layer     │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
├─────────────────────────────────────────────────────────────┤
│  Core Layer                                                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │    Core     │  │   Database  │  │    User     │         │
│  │   Engine    │  │   Access    │  │ Management  │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
├─────────────────────────────────────────────────────────────┤
│  Data Layer                                                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │   MySQL/    │  │  File Cache │  │   Storage   │         │
│  │  MariaDB    │  │   System    │  │   System    │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────┘
```

## Основные компоненты

### 1. Ядро системы (Core)

**Расположение:** `/core/`

Ядро отвечает за базовую функциональность:

- **core.php** - Основные функции и константы
- **security.php** - Система безопасности
- **template.php** - Движок шаблонов
- **user.php** - Управление пользователями
- **admin.php** - Административные функции

#### Ключевые функции ядра:

```php
// Основные определения
define('BLOCK_FILE', true);
define('FUNC_FILE', true);
define('BASE_DIR', str_replace('\\', '/', dirname(__DIR__)));

// Базовые директории
define('CONFIG_DIR', BASE_DIR.'/config');
define('UPLOADS_DIR', BASE_DIR.'/uploads');
define('CACHE_DIR', BASE_DIR.'/storage/cache');
```

### 2. Система конфигурации

**Расположение:** `/config/`

Все настройки системы хранятся в отдельных файлах конфигурации:

- **000config.php** - Основная конфигурация
- **config_db.php** - Настройки базы данных
- **config_security.php** - Параметры безопасности
- **config_*.php** - Модульные конфигурации

#### Структура конфигурации:

```php
$confdb = array(
    'host' => 'localhost',
    'uname' => 'username',
    'pass' => 'password',
    'name' => 'database',
    'type' => 'mysqli',
    'engine' => 'InnoDB',
    'charset' => 'utf8mb4',
    'collate' => 'utf8mb4_unicode_ci'
);
```

### 3. Модульная система

**Расположение:** `/modules/`

Каждый модуль представляет собой отдельную функциональность:

```
modules/
├── news/           # Система новостей
├── pages/          # Статические страницы
├── forum/          # Форум
├── shop/           # Интернет-магазин
├── files/          # Файловый архив
├── media/          # Медиа-галерея
├── users/          # Управление пользователями
└── voting/         # Система голосований
```

#### Структура модуля:

```
module_name/
├── index.php       # Основной файл модуля
├── language/       # Языковые файлы
│   ├── lang-english.php
│   ├── lang-russian.php
│   └── lang-german.php
└── admin/          # Административные файлы
    └── index.php
```

### 4. Система шаблонов

**Расположение:** `/templates/`

Поддерживает множественные темы оформления:

```
templates/
├── default/        # Стандартная тема
├── lite/          # Облегченная тема
└── admin/         # Административная тема
```

#### Функции шаблонизации:

```php
// Основные шаблонные функции
function setTemplateBasic($type, $values = array())
function setTemplateWarning($type, $values = array())
function setThemeInclude()
```

### 5. Система безопасности

**Многоуровневая защита:**

1. **Проверка доступа к файлам:**
```php
if (!defined('MODULE_FILE') && !defined('ADMIN_FILE')) 
    die('Illegal file access');
```

2. **Фильтрация входных данных:**
```php
function getVar($method, $name, $type, $default = '')
```

3. **Защита от SQL-инъекций** через подготовленные запросы

4. **CSRF защита** через токены

5. **Капча и reCAPTCHA** интеграция

### 6. Система кэширования

**Многоуровневое кэширование:**

1. **Браузерное кэширование:**
```php
function setCache($id = '') {
    if ($id === "1") {
        $max = $cached * 86400;
        header('Cache-Control: public, max-age='.$max);
    }
}
```

2. **Файловое кэширование:**
- CSS файлы: `/config/cache/`
- JavaScript файлы: `/config/cache/`
- Контент: настраиваемое время жизни

3. **Сжатие ресурсов:**
```php
function getCompressCss($css)
function getCompressCode($code)
function getCompressHtml($html)
```

### 7. База данных

**Слой абстракции БД поддерживает:**

- MySQL/MariaDB (основной)
- Подготовленные запросы
- Автоматическое экранирование
- Пулинг соединений

#### Структура таблиц:

```sql
-- Основные таблицы
{prefix}_modules        -- Модули системы
{prefix}_categories     -- Категории
{prefix}_users          -- Пользователи
{prefix}_groups         -- Группы пользователей
{prefix}_blocks         -- Блоки интерфейса
{prefix}_config         -- Конфигурация
```

## Принципы проектирования

### 1. Модульность
- Каждый модуль независим
- Четкое API между модулями
- Возможность отключения модулей

### 2. Безопасность
- Принцип минимальных привилегий
- Валидация всех входных данных
- Защита от основных атак (XSS, CSRF, SQL-injection)

### 3. Производительность
- Эффективные алгоритмы
- Минимизация запросов к БД
- Интеллектуальное кэширование
- Сжатие ресурсов

### 4. Расширяемость
- Система плагинов
- Хуки и события
- Настраиваемые шаблоны

## Жизненный цикл запроса

1. **Точка входа** (`index.php`)
2. **Загрузка ядра** (`core/core.php`)
3. **Инициализация безопасности**
4. **Определение модуля** через параметр `name`
5. **Проверка прав доступа**
6. **Загрузка модуля**
7. **Рендеринг контента**
8. **Применение шаблона**
9. **Вывод результата**

## Оптимизация производительности

### Встроенные механизмы:
- Кэширование CSS/JS файлов
- Сжатие HTML, CSS, JavaScript
- Оптимизация SQL запросов
- Ленивая загрузка компонентов
- Управление сессиями

### Рекомендации по настройке:
- Включить кэширование на уровне веб-сервера
- Настроить сжатие gzip
- Использовать CDN для статических ресурсов
- Оптимизировать настройки PHP (OPcache)

## Развертывание

### Требования к среде:
- **Веб-сервер:** Apache 2.4+ / Nginx 1.14+
- **PHP:** 8.0+ с расширениями mysqli, gd, zip
- **База данных:** MySQL 5.7+ / MariaDB 10.3+
- **Память:** минимум 128MB для PHP

### Рекомендуемые настройки PHP:
```ini
memory_limit = 256M
upload_max_filesize = 32M
post_max_size = 32M
max_execution_time = 300
```

Эта архитектура обеспечивает высокую производительность, безопасность и масштабируемость SLAED CMS при сохранении простоты использования и настройки.